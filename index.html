<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="style.css">
    <style type="text/css">
      html, body, #map-canvas { height: 100%; margin: 0; padding: 0;}
    </style>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/leaflet/0.7.3/leaflet.css" />
    <script src="//cdn.jsdelivr.net/leaflet/0.7.3/leaflet.js"></script>
    <script src="http://cdn-geoweb.s3.amazonaws.com/esri-leaflet/1.0.0-rc.6/esri-leaflet.js"></script>
    <script src="http://cdn-geoweb.s3.amazonaws.com/esri-leaflet-renderers/0.0.1-beta.3/esri-leaflet-renderers.js"></script>
  </head>
  <body>
    <div id='legend' style='display:none;'>
      <strong>Vacant Lots</strong>
      <nav class='legend clearfix'>
        <span style='background:#F1EEF6;'></span>
        <span style='background:#BDC9E1;'></span>
        <label>Public Owned</label>
        <label>Privately Owned</label>
        <small>Source: <a href="#link to source">Portland BPS</a></small>
    </div>
    <div id="map"></div>
    <script>

      var map = L.map('map').setView([45.52, -122.6819], 12);
      map.legendControl.addTo(document.getElementById('legend').innerHTML);
      L.esri.basemapLayer('Gray').addTo(map);
      vacantLots = L.esri.featureLayer('http://services.arcgis.com/rOo16HdIMeOBI4Mb/ArcGIS/rest/services/NonPark_vacant_BLInon_openspace/FeatureServer/0',{
        simplifyFactor: 0.4,
        precision: 5,
        style: function (feature) {
          if(feature.properties.isPublic == 1){
            return {color: '#c51b8a', weight: 0, fillOpacity: 0.6};
          }
          else {
            return {color: '#b2182b', weight: 0, fillOpacity: 0.6};
          }
        }
      })

      // vacantLots.addTo(map);

      newResPermits = L.esri.featureLayer('http://services.arcgis.com/rOo16HdIMeOBI4Mb/arcgis/rest/services/New%20Construction%20Residential%20Permits/FeatureServer/0');
      singleFamilyValue = L.esri.featureLayer('http://services.arcgis.com/rOo16HdIMeOBI4Mb/arcgis/rest/services/residential_permits/FeatureServer/0');
      condoPermits = L.esri.featureLayer('http://services.arcgis.com/rOo16HdIMeOBI4Mb/arcgis/rest/services/residential_permits/FeatureServer/0');
      apartmentPermits = L.esri.featureLayer('http://services.arcgis.com/rOo16HdIMeOBI4Mb/arcgis/rest/services/residential_permits/FeatureServer/0');

      var overlays = {
        "New Residential Construction Permits": newResPermits,
        "Projected Value for Single Family Homes": singleFamilyValue,
        "Condo Permits": condoPermits,
        "Apartment Permits": apartmentPermits
      };

      L.control.layers(overlays).addOverlay(map);

      singleFamilyValue.addTo(map);

      vacantLots.bindPopup(function(feature){
        return L.Util.template('<p><strong>Owner: </strong>{OWNER1}<br><strong>Address:</strong> {SITEADDR}<br><strong>General Use:</strong> {GEN_USE}</p>', feature.properties);
      });
    </script>
  </body>
</html>
